<!-- Task Item -->
<li class="px-4 sm:px-6 py-4 mb-2 hover:bg-gray-50 transition-colors group {% if task.completed %}bg-gray-50/50{% else %}border-l-4 border-indigo-100{% endif %} {% if task.details %}task-item{% endif %} rounded-lg" data-task-id="{{ task.id }}">
    <div class="flex items-start justify-between {% if task.details %}cursor-pointer task-header{% endif %}">
        <div class="flex items-start space-x-3 sm:space-x-4 flex-1 min-w-0">
            <!-- Toggle Completion -->
            <form action="{% url 'tasks:toggle_task' task.id %}" method="post" class="flex-shrink-0 mt-0.5" onclick="event.stopPropagation()">
                {% csrf_token %}
                <button type="submit" class="focus:outline-none hover:scale-110 transition-transform" aria-label="Toggle completion">
                    <div class="w-5 h-5 sm:w-6 sm:h-6 rounded-full border-2 flex items-center justify-center transition-colors
                        {% if task.completed %}
                            bg-green-100 border-green-200 text-green-600 hover:bg-green-200
                        {% else %}
                            border-gray-300 hover:border-indigo-400 bg-white
                        {% endif %}">
                        {% if task.completed %}
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5 sm:h-4 sm:w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7" />
                            </svg>
                        {% endif %}
                    </div>
                </button>
            </form>
            
            <!-- Task Details -->
            <div class="min-w-0 flex-1">
                <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
                    <div class="min-w-0">
                        <div class="flex items-center w-full min-w-0">
                            <p class="text-sm sm:text-base font-medium text-gray-900 leading-tight {% if task.completed %}line-through text-gray-500{% else %}group-hover:text-indigo-600{% endif %} transition-colors break-words overflow-hidden text-ellipsis whitespace-normal w-full">
                                {{ task.title|truncatechars:100 }}
                            </p>
                            {% if task.details %}
                            <svg class="w-4 h-4 ml-2 text-gray-400 transition-transform transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                            </svg>
                            {% endif %}
                        </div>
                        {# Preview of details is now hidden by default #}
                    </div>
                    <div class="mt-1 sm:mt-0 sm:ml-4 flex-shrink-0 flex items-center space-x-2">
                        {% if task.due_date %}
                            {% if not task.completed %}
                                {% if task.due_date < today %}
                                    <span class="text-xs px-2 py-0.5 rounded-full bg-red-100 text-red-700 font-medium whitespace-nowrap" title="Overdue: Due {{ task.due_date|date:'M d' }}">
                                        Due: {{ task.due_date|date:'M d' }}
                                    </span>
                                {% elif task.due_date == today %}
                                    <span class="text-xs px-2 py-0.5 rounded-full bg-yellow-100 text-yellow-700 font-medium whitespace-nowrap" title="Due today">
                                        Today
                                    </span>
                                {% else %}
                                    <span class="text-xs px-2 py-0.5 rounded-full bg-blue-50 text-blue-700 font-medium whitespace-nowrap" title="Due: {{ task.due_date|date:'M d' }}">
                                        {{ task.due_date|date:'M d' }}
                                    </span>
                                {% endif %}
                            {% else %}
                                <span class="text-xs text-gray-400 line-through whitespace-nowrap">
                                    {{ task.due_date|date:'M d' }}
                                </span>
                            {% endif %}
                        {% else %}
                            <span class="text-xs text-gray-400 whitespace-nowrap">
                                {{ task.created|date:'M d' }}
                            </span>
                        {% endif %}
                        <button type="button" class="ml-2 sm:ml-3 text-gray-400 hover:text-red-500 transition-colors sm:opacity-0 sm:group-hover:opacity-100" 
                                onclick="event.stopPropagation(); this.closest('li').querySelector('form[action*=\'delete\']').requestSubmit()"
                                aria-label="Delete task">
                            <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                            </svg>
                        </button>
                        <!-- Hidden delete form for actual submission -->
                        <form action="{% url 'tasks:delete_task' task.id %}" method="post" class="hidden">
                            {% csrf_token %}
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Task Details Panel -->
    <div class="task-details-panel overflow-hidden transition-all duration-300 ease-in-out max-h-0">
            <div class="flex justify-between items-start gap-4">
                <div class="flex-1">
                    {% if task.details %}
                        <div class="mb-3">
                            <p class="whitespace-pre-line text-gray-700">{{ task.details }}</p>
                        </div>
                    {% endif %}
                </div>
                
                <div class="text-right text-xs text-gray-400 whitespace-nowrap">
                    <div class="mb-1">
                        <div class="text-[10px] text-gray-500">Created</div>
                        <div class="font-medium text-gray-700">{{ task.created|date:"M d, Y" }}</div>
                    </div>
                    {% if task.due_date %}
                        <div class="mt-2">
                            <div class="text-[10px] text-gray-500">Due</div>
                            <div class="font-medium {% if not task.completed and task.due_date < today %}text-red-600{% else %}text-gray-700{% endif %}">
                                {{ task.due_date|date:"M d, Y" }}
                            </div>
                        </div>
                    {% endif %}
                </div>
            </div>
            
            <div class="mt-3 pt-2 border-t border-gray-100">
        </div>
    </div>
</li>
