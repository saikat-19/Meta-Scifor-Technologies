{% extends 'pages/dashboard/base.html' %}
{% load static %}

{% block dashboard_content %}
<div class="bg-white shadow rounded-lg overflow-hidden">
    <!-- Header -->
    <div class="px-6 py-5 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-indigo-50">
        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
            <div class="space-y-1">
                <div class="flex items-center gap-3">
                    <h1 class="text-2xl font-bold text-gray-900">
                        {{ product.name }}
                    </h1>
                    <span class="px-2.5 py-0.5 text-xs font-medium rounded-full {{ product.is_active|yesno:'bg-green-100 text-green-800,bg-gray-100 text-gray-800' }}">
                        {{ product.is_active|yesno:"Active,Inactive" }}
                    </span>
                </div>
                <div class="flex items-center text-sm text-gray-600">
                    <span class="font-medium">SKU:</span>
                    <span class="ml-1 font-mono bg-gray-100 px-2 py-0.5 rounded">{{ product.sku }}</span>
                </div>
            </div>
        {% if is_owner %}
        <div class="flex flex-wrap gap-3 mt-4 md:mt-0">
            <a href="{% url 'ecom:product_update' product.slug %}" class="inline-flex items-center px-4 py-2 border border-indigo-600 text-sm font-medium rounded-md shadow-sm text-indigo-700 bg-white hover:bg-indigo-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors">
                <i class="fas fa-pen-to-square mr-2"></i> Edit Product
            </a>
            <a href="{% url 'ecom:product_delete' product.slug %}" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors">
                <i class="fas fa-trash-alt mr-2"></i> Delete
            </a>
        </div>
        {% endif %}
    </div>
</div>

    <div class="px-6 py-6">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Product Images Column -->
            <div class="lg:col-span-1">
                <div class="bg-white rounded-lg border border-gray-200 overflow-hidden shadow-sm">
                    {% if images %}
                        <div class="relative aspect-square w-full">
                            <div class="swiper-container h-full w-full">
                                <div class="swiper-wrapper">
                                    {% for image in images %}
                                    <div class="swiper-slide">
                                        <div class="flex items-center justify-center h-full p-4">
                                            <img src="{{ image.image.url }}" 
                                                 alt="{{ image.alt_text|default:product.name }}" 
                                                 class="max-h-full max-w-full object-contain"
                                                 loading="lazy">
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                                <!-- Navigation buttons -->
                                <div class="swiper-button-prev !left-2 !text-gray-700 !bg-white/90 hover:!bg-white !w-8 !h-8 !rounded-full !shadow-md !transition-all"></div>
                                <div class="swiper-button-next !right-2 !text-gray-700 !bg-white/90 hover:!bg-white !w-8 !h-8 !rounded-full !shadow-md !transition-all"></div>
                                <!-- Pagination -->
                                <div class="swiper-pagination !bottom-1"></div>
                            </div>
                        </div>
                        
                        <!-- Thumbnails -->
                        {% if images|length > 1 %}
                        <div class="p-2 bg-gray-50 border-t border-gray-100">
                            <div class="grid grid-cols-4 gap-2">
                                {% for image in images %}
                                <button type="button" 
                                        class="swiper-thumbnail aspect-square border-2 border-transparent rounded overflow-hidden hover:border-indigo-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all {% if forloop.first %}border-indigo-500{% endif %}"
                                        data-slide-index="{{ forloop.counter0 }}">
                                    <img src="{{ image.image.url }}" 
                                         alt="Thumbnail {{ forloop.counter }}" 
                                         class="w-full h-full object-cover">
                                </button>
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}
                    {% else %}
                        <div class="aspect-square bg-gray-100 flex items-center justify-center">
                            <div class="text-center p-6">
                                <i class="fas fa-image text-gray-300 text-5xl mb-2"></i>
                                <p class="text-gray-400 text-sm">No images available</p>
                            </div>
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- Product Details Column -->
            <div class="lg:col-span-2">
                <!-- Product Information Card -->
                <div class="bg-white rounded-lg shadow-sm border border-gray-100 p-6 mb-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4 pb-3 border-b border-gray-100">Product Information</h3>
                    <div class="space-y-6">
                    <!-- Price & Stock -->
                    <div class="bg-blue-50 p-5 rounded-lg border border-blue-100">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Price Section -->
                            <div>
                                <h4 class="text-sm font-medium text-blue-700 uppercase tracking-wider mb-2">Price</h4>
                                <div class="flex items-baseline space-x-2">
                                    <span class="text-3xl font-bold text-gray-900">₹{{ product.price }}</span>
                                    {% if product.compare_at_price %}
                                        <span class="text-lg text-gray-500 line-through">₹{{ product.compare_at_price }}</span>
                                        <span class="ml-2 px-2 py-0.5 text-xs font-semibold rounded-full bg-green-100 text-green-800">
                                            Save {{ product.discount_percentage }}%
                                        </span>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <!-- Stock Section -->
                            <div>
                                <h4 class="text-sm font-medium text-blue-700 uppercase tracking-wider mb-2">Inventory</h4>
                                <div class="flex items-center">
                                    <div class="flex-shrink-0 mr-3">
                                        <div class="w-10 h-10 rounded-full flex items-center justify-center {% if product.stock > 0 %}bg-green-100 text-green-600{% else %}bg-red-100 text-red-600{% endif %}">
                                            <i class="fas {% if product.stock > 0 %}fa-boxes-stacked{% else %}fa-box-open{% endif %}"></i>
                                        </div>
                                    </div>
                                    <div>
                                        <p class="text-lg font-semibold {% if product.stock > 0 %}text-green-700{% else %}text-red-700{% endif %}">
                                            {{ product.stock|default:0 }} in stock
                                        </p>
                                        <p class="text-xs text-gray-500">
                                            {% if product.stock > 10 %}
                                                <span class="text-green-600">In Stock</span> - Available for immediate dispatch
                                            {% elif product.stock > 0 %}
                                                <span class="text-amber-600">Low Stock</span> - Only {{ product.stock }} left
                                            {% else %}
                                                <span class="text-red-600">Out of Stock</span> - Check back soon
                                            {% endif %}
                                        </p>
                                    </div>
                                </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Description Card -->
                    <div class="bg-white rounded-lg shadow-sm border border-gray-100 overflow-hidden">
                        <div class="px-6 py-4 border-b border-gray-100">
                            <h3 class="text-lg font-semibold text-gray-900">Product Description</h3>
                        </div>
                        <div class="p-6">
                            {% if product.description %}
                                <div class="prose max-w-none text-gray-600">
                                    {{ product.description|linebreaks }}
                                </div>
                            {% else %}
                                <p class="text-gray-400 italic">No description provided.</p>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Product Details Card -->
                    <div class="bg-white rounded-lg shadow-sm border border-gray-100 overflow-hidden">
                        <div class="px-6 py-4 border-b border-gray-100">
                            <h3 class="text-lg font-semibold text-gray-900">Product Details</h3>
                        </div>
                        <div class="divide-y divide-gray-100">
                            <div class="p-6">
                                <dl class="space-y-4">
                                    <div class="flex items-start">
                                        <dt class="w-1/3 text-sm font-medium text-gray-500">Category</dt>
                                        <dd class="text-sm text-gray-900">
                                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800">
                                                {{ product.category.name }}
                                            </span>
                                        </dd>
                                    </div>
                                    {% if product.brand %}
                                    <div class="flex items-start">
                                        <dt class="w-1/3 text-sm font-medium text-gray-500">Brand</dt>
                                        <dd class="text-sm text-gray-700">
                                            <span class="inline-flex items-center">
                                                <i class="fas fa-tag text-gray-400 mr-2 text-xs"></i>
                                                {{ product.brand }}
                                            </span>
                                        </dd>
                                    </div>
                                    {% endif %}
                                    <div class="flex items-start">
                                        <dt class="w-1/3 text-sm font-medium text-gray-500">Created</dt>
                                        <dd class="text-sm text-gray-700">
                                            <span class="inline-flex items-center">
                                                <i class="far fa-calendar text-gray-400 mr-2 text-xs"></i>
                                                {{ product.created_at|date:"M d, Y" }}
                                            </span>
                                        </dd>
                                    </div>
                                    {% if product.updated_at %}
                                    <div class="flex items-start">
                                        <dt class="w-1/3 text-sm font-medium text-gray-500">Last Updated</dt>
                                        <dd class="text-sm text-gray-700">
                                            <span class="inline-flex items-center">
                                                <i class="fas fa-sync-alt text-gray-400 mr-2 text-xs"></i>
                                                {{ product.updated_at|date:"M d, Y" }}
                                            </span>
                                        </dd>
                                    </div>
                                    {% endif %}
                                </dl>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css">
<style>
.swiper-container {
    width: 100%;
    height: 100%;
    position: relative;
    border-radius: 0.5rem;
    overflow: hidden;
}

.swiper-slide {
    display: flex;
    align-items: center;
    justify-content: center;
    background: #fff;
    padding: 2rem;
}

.swiper-slide img {
    max-width: 100%;
    max-height: 100%;
    width: auto;
    height: auto;
    object-fit: contain;
    transition: transform 0.3s ease;
}

/* Navigation buttons */
.swiper-button-prev,
.swiper-button-next {
    background: rgba(255, 255, 255, 0.9);
    width: 2.5rem;
    height: 2.5rem;
    border-radius: 50%;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
    opacity: 0;
}

.swiper-button-prev {
    left: 0.5rem !important;
}

.swiper-button-next {
    right: 0.5rem !important;
}

.swiper-button-prev:hover,
.swiper-button-next:hover {
    background: white;
    transform: scale(1.05);
}

.swiper-button-prev:after,
.swiper-button-next:after {
    font-size: 1.25rem;
    color: #374151;
    font-weight: bold;
}

/* Show navigation on container hover */
.group:hover .swiper-button-prev,
.group:hover .swiper-button-next {
    opacity: 1;
}

/* Pagination */
.swiper-pagination-bullet {
    background: rgba(0, 0, 0, 0.3);
    opacity: 1;
    width: 8px;
    height: 8px;
    margin: 0 4px !important;
}

.swiper-pagination-bullet-active {
    background: #4F46E5;
    transform: scale(1.2);
}
</style>
{% endblock %}

{% block extra_js %}
<script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const swiper = new Swiper('.swiper-container', {
        loop: false,
        spaceBetween: 0,
        slidesPerView: 1,
        centeredSlides: true,
        watchSlidesProgress: true,
        pagination: {
            el: '.swiper-pagination',
            clickable: true,
            type: 'bullets',
            dynamicBullets: true,
            dynamicMainBullets: 4,
            renderBullet: function (index, className) {
                return `<span class="${className} !w-2 !h-2 !mx-1 !my-0"></span>`;
            },
        },
        navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
        },
        keyboard: {
            enabled: true,
            onlyInViewport: true,
        },
        breakpoints: {
            640: {
                spaceBetween: 10,
            },
            1024: {
                spaceBetween: 20,
            },
        },
    });

    // Handle thumbnail clicks
    document.querySelectorAll('.swiper-thumbnail').forEach((thumb, index) => {
        thumb.addEventListener('click', () => {
            swiper.slideTo(index);
            // Update active thumbnail
            document.querySelectorAll('.swiper-thumbnail').forEach(t => t.classList.remove('border-indigo-500'));
            thumb.classList.add('border-indigo-500');
        });
    });

    // Update active thumbnail on slide change
    swiper.on('slideChange', () => {
        const activeIndex = swiper.activeIndex % swiper.slides.length;
        document.querySelectorAll('.swiper-thumbnail').forEach((thumb, index) => {
            if (index === activeIndex) {
                thumb.classList.add('border-indigo-500');
            } else {
                thumb.classList.remove('border-indigo-500');
            }
        });
    });

    // Handle keyboard navigation for better accessibility
    document.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowLeft') {
            swiper.slidePrev();
        } else if (e.key === 'ArrowRight') {
            swiper.slideNext();
        }
    });
});
</script>
{% endblock %}
